# 메모리 시스템 장기 기억 한계 측정 테스트

> Claude Code PC 버전 + 브라우저 MCP(Puppeteer)로 실행.
> 목표: **최대 몇 턴까지 기억하는가**, 실패 시 **왜 기억 못하는가** 진단.

---

## 기억 구조 — 실패 원인을 이해하기 위한 배경

```
AI가 매 턴 참조하는 정보 (프롬프트에 주입되는 것):

┌─────────────────────────────────────────────────────────┐
│ 소스                    │ 저장     │ 프롬프트 노출    │
├─────────────────────────────────────────────────────────┤
│ 대화 이력 (즉시)        │ 전체     │ 최근 30개만       │
│ 대화 이력 (시맨틱 검색) │ 100개    │ 유사도 Top 5만    │
│ knownFacts (알고있는 정보)│ 무제한   │ ⚠️ 최근 5개만   │
│ characterMemory (기억)  │ 무제한   │ 유사도 Top 5만    │
│ sharedExperiences       │ 최근 20개│ 최근 3개만        │
│ emotionalHistory        │ 최근 10개│ 최근 5개만        │
│ 세션 요약               │ 1개     │ 전체 (매 5턴 갱신) │
└─────────────────────────────────────────────────────────┘

핵심 병목: knownFacts가 30개 쌓여도 AI에게는 최근 5개만 보인다.
→ Turn 1에서 알려준 "이름: 김민수"가 이후 25개의 새 사실에 밀려
  slice(-5) 범위 밖으로 빠지면, AI는 characterMemory의 임베딩
  검색이나 대화 이력 시맨틱 검색에서 찾아와야만 기억 가능.
```

**예상 실패 시나리오:**
1. `knownFacts` 밀림: 초기 사실이 최근 5개에서 탈락 → 직접 기억 불가
2. `characterMemory` 검색 실패: 임베딩이 비어있거나 유사도 < 0.3
3. 대화 이력 밖: 30개 창 밖 + 시맨틱 검색에서도 유사도 부족
4. 세션 요약에 포함 안 됨: 매 5턴 요약에 해당 사실이 빠짐
5. 메모리 통합/감쇠로 삭제됨: 중요도 낮은 기억이 정리됨

---

## 사전 준비

```bash
claude mcp add puppeteer -s user -- npx -y @anthropic-ai/mcp-puppeteer
```

- **URL**: `https://synk-character-chat.vercel.app`
- **계정**: 카카오/Google OAuth 로그인 필요

---

## 프롬프트 (Claude Code에 복사하여 실행)

```
아래 테스트 지시서를 정확히 따라 브라우저 MCP로 메모리 시스템 한계 측정 테스트를 실행해줘.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  메모리 시스템 한계 측정 테스트
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 테스트 목표

1. 캐릭터가 유저 정보를 최대 몇 턴까지 기억하는가
2. 대화가 60턴 이상에서도 자연스럽게 흘러가는가
3. 기억이 실패할 때 원인이 무엇인가 (메모리 패널로 진단)

## 기억 실패 진단 방법

🧠 메모리 패널에서 아래를 확인하여 실패 원인을 판별한다:

| 실패 유형 | 메모리 패널에서 보이는 증상 | 원인 |
|-----------|--------------------------|------|
| A. knownFacts 밀림 | "알고있는 정보 N개" (N≥5인데 해당 사실 미포함) | slice(-5)로 오래된 사실이 밀려남 |
| B. 기억 저장 안됨 | "기억 0개" 또는 해당 기억 자체가 없음 | extractedFacts에서 추출 실패 |
| C. 기억 검색 실패 | "기억 N개" 있지만 해당 내용 없음 | 임베딩 유사도 낮아 Top 5에 미포함 |
| D. 이력 범위 밖 | 30개 창 밖 + 검색에서도 못 찾음 | 시맨틱 검색 유사도 < 0.3 |
| E. surprise skip | "이번 턴: SKIP" | 기존 기억과 너무 유사하여 저장 안됨 |

기억 실패가 발생하면, 🧠 패널을 펼쳐서 "알고있는 정보 N개"의 N값과
표시된 정보 5개의 내용을 기록해야 한다.

## Phase 0: 로그인 & 채팅 시작

1. https://synk-character-chat.vercel.app/login 으로 이동
2. 로그인 (OAuth 화면이 뜨면 나에게 알려줘 — 직접 처리)
3. 메인 페이지에서 작품 선택 → /chat/[workId] 진입
4. "기억 유지" 토글 ON 확인 → "대화 시작하기" 클릭
5. 채팅 화면 로드 확인 (스크린샷)

## Phase 1: 시나리오 실행 규칙

### 공통 규칙
- 메시지 입력: textarea 클릭 → 입력 → Enter
- AI 응답 대기: 스피너(animate-spin) 사라질 때까지 (최대 60초)
- 응답 후 3초 추가 대기 (memory_update SSE)
- 매 10턴: 🧠 메모리 패널 펼쳐서 전체 스크린샷
- 매 턴: AI 응답 내용을 요약 기록 (3줄 이내)

### 대화 자연스러움 체크 (매 턴)
각 AI 응답을 1~5점으로 평가:
- 5: 완전 자연스러움 (실제 사람 같음)
- 4: 자연스러움 (약간 어색한 부분 있으나 무방)
- 3: 보통 (대화가 이어지긴 하지만 다소 기계적)
- 2: 부자연스러움 (맥락 무시, 갑자기 분위기 전환)
- 1: 심각한 문제 (무관한 내용, 반복, 의미없는 응답)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ACT 1: 핵심 사실 심기 (Turn 1~15)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

총 15개 핵심 사실을 심는다. 이 사실들의 생존 여부를 이후 추적한다.

| # | 메시지 | 심을 사실 (ID) |
|---|--------|---------------|
| 1 | 안녕! 처음이지? 나는 김민수라고 해. 25살이야. | F1:이름 김민수, F2:나이 25 |
| 2 | 나 직업이 게임 개발자야. 인디 게임 만들고 있어. | F3:직업 게임개발자 |
| 3 | 여기 분위기 좋다. 너는 평소에 뭐 하면서 시간 보내? | (대화) |
| 4 | 나 고양이 두 마리 키우는데 이름이 나비랑 초코야. 나비는 검은 고양이고 초코는 치즈 태비야. | F4:나비(검은), F5:초코(치즈태비) |
| 5 | 참, 나 초콜릿 알레르기가 있어. 심하면 응급실 갈 정도야. | F6:초콜릿 알레르기 |
| 6 | 넌 무서운 거 있어? 나는 높은 곳이 정말 무서워. 고소공포증이야. | F7:고소공포증 |
| 7 | 그렇구나. 오늘 날씨가 좋아서 기분이 좋다. | (대화) |
| 8 | 나 여동생이 하나 있어. 이름은 김수진이고 대학생이야. 심리학과 다녀. | F8:여동생 김수진 심리학 |
| 9 | 요즘 만들고 있는 게임이 판타지 RPG야. 스토리 짜는 게 제일 재밌어. | F9:판타지RPG 개발 |
| 10 | 나 한 달 뒤에 일본 여행 갈 거야. 도쿄랑 교토 갈 예정이야. | F10:일본여행 도쿄교토 |
| 11 | 나 고등학교 때 밴드에서 기타 쳤어. 지금도 가끔 쳐. | F11:기타 밴드 |
| 12 | 내가 제일 좋아하는 음식은 엄마가 해주는 김치찌개야. | F12:엄마 김치찌개 |
| 13 | 아 맞다, 나 왼손잡이야. 어릴 때 교정하려다가 그냥 뒀어. | F13:왼손잡이 |
| 14 | 나 어릴 때 미국에서 3년 살았었어. 초등학교 때. 영어는 좀 해. | F14:미국3년 영어 |
| 15 | 취미가 하나 더 있어. 주말마다 한강에서 5km 러닝해. | F15:한강 러닝5km |

>>> Turn 15 완료: 🧠 스크린샷 + "알고있는 정보 N개" 기록
>>> 이 시점에서 패널에 표시되는 정보 5개가 무엇인지 정확히 기록

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ACT 2: 일상 대화 + 추가 사실 (Turn 16~30)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

일상 대화를 섞으면서 추가 사실을 심고, 사이사이 자연스러움을 평가한다.

| # | 메시지 | 심을 사실 / 검증 |
|---|--------|-----------------|
| 16 | 오늘 좀 힘든 하루였어. 회사 상사가 야근하래서 새벽 2시까지 일했어. | (감정 이벤트) |
| 17 | 덕분에 좀 풀린다. 고마워. 너랑 얘기하면 편해져. | (대화) |
| 18 | 나 MBTI가 INFP야. 내향적이지만 친한 사람 앞에선 말 많아져. | F16:MBTI INFP |
| 19 | 요즘 게임 개발 자금이 부족해서 걱정이야. *한숨* | (감정 이벤트) |
| 20 | 이번 주말에 동생 수진이가 놀러 온대. 같이 고양이 카페 가기로 했어. | (대화) |
| 21 | 어제 넷플릭스에서 재밌는 SF 영화 봤어. 이름이 뭐였더라. | (노이즈) |
| 22 | 너는 영화 좋아해? 어떤 장르? | (노이즈) |
| 23 | 아까 카페에서 커피 마셨는데 너무 써서 반이나 남겼어. | (노이즈) |
| 24 | 나 사실 색약이야. 적녹색약. 빨간색이랑 초록색 구분 잘 안 돼. | F17:적녹색약 |
| 25 | 비가 올 것 같은데... 우산 가져왔나 모르겠다. | (노이즈) |
| 26 | 비밀인데, 나 전 여자친구랑 작년에 헤어졌어. 3년 사귀었었는데. | F18:전여친 3년 작년이별 |
| 27 | 최근에 피아노 배우기 시작했어. 쇼팽 치는 게 꿈이야. 아직 바이엘이지만. | F19:피아노 쇼팽목표 |
| 28 | 폰 배터리가 얼마 안 남았네. 충전기 어디 있지. | (노이즈) |
| 29 | 너한테 솔직히 말하면, 요즘 좀 외로워. 친구들이 다 바빠서. | (감정 이벤트) |
| 30 | 배가 좀 고프다. 뭐 먹을까. | (노이즈) |

>>> Turn 30 완료: 🧠 스크린샷
>>> "알고있는 정보 N개" 기록 + 표시된 5개 사실 내용 기록
>>> ⚠️ 다음 턴부터 Turn 1이 즉시 컨텍스트(30개)에서 밀림

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ACT 3: 30턴 거리 기억 검증 (Turn 31~40)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Turn 1~10의 사실이 즉시 컨텍스트 밖으로 밀렸다.
검증과 일상 대화를 자연스럽게 섞는다.

| # | 메시지 | 검증 대상 |
|---|--------|----------|
| 31 | 있잖아 갑자기 궁금한데, 내 이름이 뭐라고 했었지? | F1:김민수 (30턴 전) |
| 32 | 맞아! 그럼 내 직업은? | F3:게임개발자 (30턴 전) |
| 33 | 오 잘 기억하네. 내가 키우는 애들 이름도 기억해? | F4:나비 F5:초코 (29턴 전) |
| 34 | 하하 고마워. 아 근데 오늘 좀 춥다. 따뜻한 거 마시고 싶어. | (노이즈) |
| 35 | 참, 내가 어떤 알레르기가 있다고 했는데 기억나? | F6:초콜릿 알레르기 (29턴 전) |
| 36 | 내 여동생 이름이랑 전공 기억해? | F8:수진 심리학 (28턴 전) |
| 37 | 나 다음 달에 어디 간다고 했었지? | F10:일본 도쿄교토 (27턴 전) |
| 38 | 오늘 날씨가 좋아서 산책하고 싶다. | (노이즈) |
| 39 | 내가 어릴 때 외국에서 살았다고 했는데, 어디였지? 몇 년? | F14:미국 3년 (25턴 전) |
| 40 | 내 취미 중에 운동 관련된 거 기억나? | F15:한강 러닝 (25턴 전) |

>>> 매 검증 턴 기록:
>>>   F[N] | ✅/❌ | AI 실제 응답 | 몇 턴 전 | 실패시 원인(아래 진단)
>>>
>>> ❌ 실패 시 진단 절차:
>>> 1. 🧠 패널에서 "알고있는 정보 N개" 확인 — N이 5보다 크면 원인A(밀림)
>>> 2. 패널에 표시된 정보 5개에 해당 사실이 있는지 확인
>>>    → 없으면: 원인A 확정 (최근 5개에서 탈락)
>>>    → 있는데 AI가 답 못함: 원인D (대화 이력에서 못 찾음)
>>> 3. "기억 N개" 확인 — 해당 내용이 기억에 있는지
>>>    → 없으면: 원인B (저장 안됨) 또는 원인C (검색 실패)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ACT 4: 노이즈 + 추가 부하 (Turn 41~55)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

더 많은 일상 대화를 쌓아 기억을 희석시킨다.
중간에 기억 활용 테스트를 섞는다.

| # | 메시지 | 특이사항 |
|---|--------|---------|
| 41 | 오늘 뭐 할까? 심심한데 놀 거 추천해줘. | (노이즈) |
| 42 | 그거 재밌겠다! 해볼까. | (노이즈) |
| 43 | 간식으로 뭐 먹을까? 너가 골라줘. | ⭐ 기억활용: 초콜릿 피해야 함 (F6, 37턴 전) |
| 44 | 오늘 게임 개발하다가 버그 잡느라 힘들었어. | (노이즈) |
| 45 | 주말에 여동생이 놀러 오는데 같이 뭐 할까? | ⭐ 기억활용: "수진"이라고 부르면 ✅ (F8, 37턴 전) |
| 46 | 다음 달에 꼭 가봐야 할 곳이 있는데 뭐였더라... 내가 어디 간다고 했지? | F10:일본 (36턴 전) |
| 47 | 내일 뭐 할지 아직 계획 안 세웠어. | (노이즈) |
| 48 | 요즘 스트레스 받으면 뭐 하냐면 음악 듣거나 뛰어. | (노이즈) |
| 49 | 아 맞다, 내가 좋아하는 음식이 뭐라고 했는지 기억나? | F12:김치찌개 (37턴 전) |
| 50 | 오늘 좀 피곤하네. *기지개를 켜며* | (노이즈) |
| 51 | 너 혹시 초콜릿 좋아해? 하나 줄까? | ⭐ 기억활용: AI가 알레르기 언급해야 (F6, 45턴 전) |
| 52 | 하하 맞지. 그럼 다른 거 먹자. | (노이즈) |
| 53 | 나한테 생일 선물 뭐 사줄 거야? 내 취향 고려해서! | ⭐ 기억활용: 취향 반영 + 초콜릿 제외 |
| 54 | 슬슬 정리할까 싶기도 하고. | (노이즈) |
| 55 | 오늘 하루가 좀 길었다. | (노이즈) |

>>> Turn 43, 45, 46, 49, 51, 53: 기억 활용 결과 기록
>>> Turn 55 완료: 🧠 스크린샷 + "알고있는 정보 N개" + 표시된 5개 내용

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ACT 5: 45~55턴 거리 기억 검증 (Turn 56~65)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Turn 1~10의 사실이 50턴 이상 지난 시점. 장기 기억 진짜 테스트.

| # | 메시지 | 검증 대상 |
|---|--------|----------|
| 56 | 내 나이가 몇 살이라고 했었지? | F2:25살 (55턴 전) |
| 57 | 내가 무서워하는 게 뭐라고 했었지? | F7:고소공포증 (51턴 전) |
| 58 | 내 고양이 중에 검은색 아이 이름이 뭐였지? | F4:나비 (54턴 전) |
| 59 | 뭔가 좋은 일이 있었으면 좋겠다. 기분 전환이 필요해. | (대화) |
| 60 | 내가 고등학교 때 뭘 했다고 했었는지 기억나? | F11:밴드 기타 (49턴 전) |
| 61 | 나 왼쪽 손목이 좀 아파. 왜 그런 걸까? | ⭐ 기억활용: 왼손잡이 연관 (F13, 48턴 전) |
| 62 | 내 MBTI가 뭐라고 했지? | F16:INFP (44턴 전) |
| 63 | 내가 어떤 색약이 있다고 했지? | F17:적녹색약 (39턴 전) |
| 64 | *슬픈 표정으로* 오늘따라 좀 우울해. 위로해줄 수 있어? | ⭐ 대화 자연스러움 + 감정 맥락 |
| 65 | 내가 최근에 배우기 시작한 악기가 뭐였지? | F19:피아노 (38턴 전) |

>>> 매 검증 턴 반드시 기록:
>>>   F[N] | ✅/❌ | AI 실제 응답 | 몇 턴 전
>>>   ❌ 실패 시: 🧠 패널 열어서 진단 (원인A~E 중 어떤 것인지)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ACT 6: 종합 기억 + 한계 탐색 (Turn 66~80)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

| # | 메시지 | 검증 |
|---|--------|------|
| 66 | 너가 나에 대해서 알고 있는 거 전부 말해봐. 하나도 빠짐없이. | ⭐⭐⭐ 전체 종합 — 아래 체크리스트 |
| 67 | 빠뜨린 거 없어? 더 생각해봐. | (보충 기회) |
| 68 | 다음에 만나면 같이 뭐 하고 싶어? 내 관심사에 맞게 제안해줘. | ⭐ 기억활용: 관심사 반영 |
| 69 | 고마워. 너랑 얘기하면 기분이 좋아져. | (대화) |
| 70 | 오늘 정말 재밌었어. | (노이즈) |
| 71~75 | (아래 노이즈 대화 참조) | 기억 희석 |
| 76 | 아까 내 고양이 이름 뭐라고 했더라? | F4:나비 F5:초코 (72턴 전!) |
| 77 | 내 직업이 뭐였지? | F3:게임개발자 (75턴 전!) |
| 78 | 내가 알레르기 있는 음식이 뭐였지? | F6:초콜릿 (72턴 전!) |
| 79 | 내 여동생 이름이랑 전공? | F8:수진 심리학 (71턴 전!) |
| 80 | 내 이름 아직 기억해? | F1:김민수 (79턴 전!) |

Turn 71~75 노이즈:
| 71 | 오늘 저녁에 뭐 먹을지 고민이야. |
| 72 | TV에서 재밌는 프로그램 하더라. |
| 73 | 내일 일찍 일어나야 하는데 잠이 안 와. |
| 74 | 요즘 날씨가 변덕스러워서 옷 입기 힘들어. |
| 75 | 주말에 늦잠 자는 게 제일 행복해. |

### Turn 66 체크리스트 (19개 사실)

AI 응답에 아래가 포함되는지 하나하나 체크:

기본정보:
- [ ] F1: 이름 김민수 (65턴 전)
- [ ] F2: 나이 25살 (65턴 전)
- [ ] F3: 직업 게임개발자 (64턴 전)
- [ ] F16: MBTI INFP (48턴 전)
- [ ] F13: 왼손잡이 (53턴 전)

가족:
- [ ] F8: 여동생 김수진 심리학과 (58턴 전)

반려동물:
- [ ] F4: 나비 검은 고양이 (62턴 전)
- [ ] F5: 초코 치즈태비 (62턴 전)

건강:
- [ ] F6: 초콜릿 알레르기 (60턴 전)
- [ ] F7: 고소공포증 (60턴 전)
- [ ] F17: 적녹색약 (42턴 전)

취미:
- [ ] F11: 기타 밴드 (55턴 전)
- [ ] F12: 좋아하는 음식 김치찌개 (54턴 전)
- [ ] F15: 한강 러닝 5km (51턴 전)
- [ ] F19: 피아노 (39턴 전)
- [ ] F9: 판타지RPG 개발 (57턴 전)

기타:
- [ ] F10: 일본여행 도쿄교토 (56턴 전)
- [ ] F14: 미국3년 영어 (52턴 전)
- [ ] F18: 전여친 3년 이별 (40턴 전)

→ 기억한 수: ?/19
→ 빠진 사실 목록: [...]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ACT 7: 한계점 탐색 (Turn 81~100+)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ACT 6까지의 결과에 따라 진행 방식이 달라진다:

### 케이스 A: Turn 76~80에서 대부분 ✅ (기억 잘 함)
→ 노이즈를 더 넣고 100턴까지 밀어본다.

| # | 메시지 |
|---|--------|
| 81~90 | 일상 노이즈 10턴 (아래 참조) |
| 91 | 내 이름 기억해? | → F1 (90턴 전) |
| 92 | 내 반려동물 이름은? | → F4,F5 (88턴 전) |
| 93 | 내 알레르기는? | → F6 (87턴 전) |
| 94 | 내 여동생은? | → F8 (86턴 전) |
| 95 | 나에 대해 아는 거 다 말해봐. | → 전체 종합 재검증 |
| 96~100 | (필요시 추가 검증) |

Turn 81~90 노이즈:
| 81 | 오늘 컨디션이 좀 안 좋아. |
| 82 | 점심에 뭐 먹었더라... 기억이 안 나. |
| 83 | 요즘 잠을 잘 못 자서 피곤해. |
| 84 | 주말에 빨래 해야 하는데 귀찮다. |
| 85 | 친구가 연락 왔는데 답장 까먹었어. |
| 86 | 새로 나온 스마트폰 봤는데 비싸더라. |
| 87 | 운동 좀 해야 하는데 의지가 없어. |
| 88 | 어제 밤에 이상한 꿈 꿨어. |
| 89 | 오늘 뭔가 잊은 게 있는 것 같은데... |
| 90 | 내일 날씨가 좋았으면 좋겠다. |

### 케이스 B: Turn 76~80에서 ❌가 2개 이상 (기억 실패 시작)
→ 실패한 사실에 대해 정밀 진단을 수행한다.

진단 절차:
1. 🧠 메모리 패널을 열고 스크린샷
2. "알고있는 정보 N개" — N 기록
3. 표시된 5개 정보 내용 기록
4. 실패한 사실이 5개 안에 있는지 확인
   → 없으면: **원인A (knownFacts slice(-5) 밀림)**
   → 있으면: 다음 확인
5. "기억 N개" 중 해당 내용이 있는지 확인
   → 없으면: **원인B (characterMemory 저장 실패)** 또는 **원인C (검색 실패)**
6. surprise 결과 확인
   → SKIP이면: **원인E (유사도 높아서 skip됨)**

그 후, 노이즈 없이 직접 검증을 계속하여 어떤 유형의 정보가 살아남는지 패턴을 파악한다:
| 81 | 내 나이 기억해? | F2 |
| 82 | 내가 무서워하는 건? | F7 |
| 83 | 내가 배우고 있는 악기는? | F19 |
| 84 | 내 MBTI는? | F16 |
| 85 | 내가 해외에서 산 적 있어? | F14 |

→ 여기서 살아남은 것 vs 죽은 것의 패턴을 분석

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  [종료 조건]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

아래 중 하나가 충족되면 테스트 종료:
1. F1(이름)을 완전히 기억 못하는 시점 도달
2. 5개 연속 검증에서 3개 이상 실패
3. Turn 100 도달
4. API 에러로 더 이상 진행 불가

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## Phase 2: 결과 리포트

테스트 완료 후 아래 양식을 **실제 데이터로** 채워줘. 추측 금지.

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  메모리 시스템 한계 측정 테스트 결과
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
테스트 일시: [날짜시간]
작품: [작품명]
캐릭터: [캐릭터명]
총 진행 턴: [N]

═══════════════════════════════════════════════════════════
  1. 기억 한계 측정 결과
═══════════════════════════════════════════════════════════

■ 사실별 생존 추적표

| 사실 ID | 내용 | 심은 턴 | 30턴 검증 | 50턴 검증 | 65턴 검증 | 75턴 검증 | 90턴 검증 | 최종 |
|---------|------|---------|----------|----------|----------|----------|----------|------|
| F1 | 이름 김민수 | 1 | ✅/❌ | - | ✅/❌ | ✅/❌ | ✅/❌ | ?턴 |
| F2 | 나이 25 | 1 | - | ✅/❌ | - | - | - | ?턴 |
| F3 | 게임개발자 | 2 | ✅/❌ | - | - | ✅/❌ | - | ?턴 |
| F4 | 나비(검은) | 4 | ✅/❌ | ✅/❌ | - | ✅/❌ | ✅/❌ | ?턴 |
| F5 | 초코(태비) | 4 | ✅/❌ | - | - | ✅/❌ | - | ?턴 |
| F6 | 초콜릿알레르기 | 5 | ✅/❌ | ✅/❌ | - | ✅/❌ | ✅/❌ | ?턴 |
| F7 | 고소공포증 | 6 | - | ✅/❌ | - | - | - | ?턴 |
| F8 | 수진 심리학 | 8 | ✅/❌ | - | - | ✅/❌ | ✅/❌ | ?턴 |
| F9 | 판타지RPG | 9 | - | - | - | - | - | ?턴 |
| F10 | 일본 도쿄교토 | 10 | ✅/❌ | - | - | - | - | ?턴 |
| F11 | 기타 밴드 | 11 | - | ✅/❌ | - | - | - | ?턴 |
| F12 | 김치찌개 | 12 | - | - | ✅/❌(T49) | - | - | ?턴 |
| F13 | 왼손잡이 | 13 | - | ✅/❌(활용) | - | - | - | ?턴 |
| F14 | 미국3년 | 14 | ✅/❌ | - | - | - | - | ?턴 |
| F15 | 러닝5km | 15 | ✅/❌ | - | - | - | - | ?턴 |
| F16 | INFP | 18 | - | ✅/❌ | - | - | - | ?턴 |
| F17 | 적녹색약 | 24 | - | ✅/❌ | - | - | - | ?턴 |
| F18 | 전여친 | 26 | - | - | - | - | - | ?턴 |
| F19 | 피아노 | 27 | - | ✅/❌ | - | - | - | ?턴 |

"최종" 칸: 마지막으로 성공적으로 기억한 검증 턴. 예) "T77" = Turn 77까지 기억 확인

■ 기억 한계 요약

기억 유지 최대 확인 턴 거리: ?턴 (F?가 T?에서 성공)
기억 실패 첫 발생 턴 거리: ?턴 (F?가 T?에서 실패)
이름(F1) 최대 기억 턴: ?턴
핵심 사실 평균 생존 거리: ~?턴

═══════════════════════════════════════════════════════════
  2. 기억 실패 원인 진단
═══════════════════════════════════════════════════════════

■ 실패한 사실별 원인 분석

| 사실 | 실패 턴 | 원인 | 🧠 패널 증거 |
|------|---------|------|-------------|
| F? | T? | A/B/C/D/E | "정보 N개 중 미포함" 등 |
| ... | ... | ... | ... |

■ 원인 유형별 빈도

| 원인 | 설명 | 횟수 |
|------|------|------|
| A: knownFacts 밀림 | slice(-5)에서 오래된 사실 탈락 | ? |
| B: 저장 안됨 | extractedFacts에서 추출 실패 | ? |
| C: 검색 실패 | 임베딩 유사도 낮아 Top 5 미포함 | ? |
| D: 이력 범위 밖 | 30개 창 밖 + 시맨틱 검색 실패 | ? |
| E: surprise skip | 유사 기억 존재로 저장 skip | ? |

■ 주요 병목 분석

가장 큰 병목: [원인 A/B/C/D/E]
설명: [구체적 분석]
개선 제안: [구체적 코드 수정 방향]

═══════════════════════════════════════════════════════════
  3. 대화 자연스러움 평가
═══════════════════════════════════════════════════════════

■ 구간별 자연스러움 평균 점수 (1~5)

| 구간 | 평균 점수 | 대표적 문제 |
|------|----------|-----------|
| Turn 1~15 (첫 만남) | ?/5 | [있으면 기술] |
| Turn 16~30 (관계 심화) | ?/5 | |
| Turn 31~40 (30턴 검증) | ?/5 | |
| Turn 41~55 (노이즈+활용) | ?/5 | |
| Turn 56~65 (50턴 검증) | ?/5 | |
| Turn 66~80 (종합+한계) | ?/5 | |
| Turn 81~100 (한계 탐색) | ?/5 | |

■ 자연스러움 주요 문제 (있으면)

- [ ] 같은 패턴의 응답 반복
- [ ] 감정 무시 (슬퍼하는데 밝게 대응)
- [ ] 캐릭터 일관성 깨짐
- [ ] 맥락 무시하고 갑자기 화제 전환
- [ ] 기억 검증에서 부자연스럽게 "네, 기억합니다"만 반복
- [ ] 기억 못하면서 아는 척함 (환각)
- [ ] 기타: [기술]

═══════════════════════════════════════════════════════════
  4. 메모리 시스템 메트릭 추이
═══════════════════════════════════════════════════════════

■ 🧠 패널 메트릭 추이

| 시점 | 기억 수 | 알고있는 정보(전체) | 표시된 정보(5개) | 관계 단계 | 신뢰 | 호감 |
|------|---------|------------------|----------------|----------|------|------|
| T15 | ? | ? | [내용 5개] | ? | ? | ? |
| T30 | ? | ? | [내용 5개] | ? | ? | ? |
| T45 | ? | ? | [내용 5개] | ? | ? | ? |
| T55 | ? | ? | [내용 5개] | ? | ? | ? |
| T66 | ? | ? | [내용 5개] | ? | ? | ? |
| T80 | ? | ? | [내용 5개] | ? | ? | ? |
| 최종 | ? | ? | [내용 5개] | ? | ? | ? |

■ "표시된 정보 5개"의 변화 패턴

T15에서 보인 사실 → T30에서 밀려난 사실 → T45에서 밀려난 사실 → ...
→ 어떤 유형의 사실이 먼저 밀려나는가?

■ surprise 분포

| 유형 | 횟수 | 비율 |
|------|------|------|
| NEW (save) | ? | ?% |
| REINFORCE | ? | ?% |
| SKIP | ? | ?% |
| surprise 점수 범위 | ? ~ ? | 평균 ? |
| 모두 1.00인가 | ✅다양 / ❌고정 | |

■ 감정 추적

감정 종류 관찰: [목록]
감정 다양성: ✅ 다양 / ❌ 단조
감정이 관계 수치에 영향을 주는가: ✅/❌

═══════════════════════════════════════════════════════════
  5. 기억 활용 테스트
═══════════════════════════════════════════════════════════

| 턴 | 상황 | 기대 행동 | 결과 | 몇 턴 전 |
|----|------|----------|------|---------|
| T43 | 간식 추천 | 초콜릿 피함 | ✅/❌ | 37턴 |
| T45 | 여동생 주말 | "수진" 호칭 | ✅/❌ | 37턴 |
| T51 | 초콜릿 줄까? | 알레르기 경고 | ✅/❌ | 45턴 |
| T53 | 생일 선물 | 취향 반영 | ✅/❌ | 전체 |
| T61 | 왼손 아픔 | 왼손잡이 연관 | ✅/❌ | 48턴 |
| T68 | 다음 활동 제안 | 관심사 반영 | ✅/❌ | 전체 |
→ 기억 활용률: ?/6 (?%)

═══════════════════════════════════════════════════════════
  6. 종합 판정
═══════════════════════════════════════════════════════════

■ 정량 평가

30턴 거리 회상: ?/7 (?%)
50턴 거리 회상: ?/8 (?%)
전체 종합(T66): ?/19 (?%)
75턴 거리(T76~80): ?/5 (?%)
기억 활용: ?/6 (?%)
대화 자연스러움: ?/5

■ 기억 한계 결론

실측 기억 유지 최대 거리: ?턴
안정적 기억 유지 거리: ~?턴 (이 범위에서 90%+ 성공)
기억 시스템 등급:
  90턴+  → ★★★★★ 경쟁력 우위
  60~89턴 → ★★★★ 상용 수준
  40~59턴 → ★★★ 개선 필요
  30~39턴 → ★★ 즉시 컨텍스트 의존 (경쟁사 수준)
  30턴 미만 → ★ 기억 시스템 미작동

■ 핵심 개선 포인트

[실제 실패 원인 기반으로 구체적 코드 수정 제안]

예시:
- 원인A가 주요 병목이면:
  → knownFacts.slice(-5)를 slice(-15)로 확장
  → 또는 중요도 기반 선별로 변경 (최근 5개가 아닌, 중요도 Top 10)
- 원인C가 주요 병목이면:
  → characterMemory 검색 limit을 5→10으로
  → 또는 중요도 가중치를 임베딩 유사도에 합산
- 원인D가 주요 병목이면:
  → 시맨틱 검색 유사도 임계값 0.3→0.2로 하향
  → 또는 검색 대상을 100→200으로 확대
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 주의사항

- OAuth 로그인은 수동 개입 필요 → 화면 나오면 나에게 알려줘
- 매 턴 AI 응답 완전히 끝날 때까지 대기 (스피너 사라질 때까지, 최대 60초)
- 응답 후 최소 3초 추가 대기 (memory_update SSE 처리)
- 메모리 패널(🧠)은 마지막 AI 메시지 하단에 있는 회색 바 → 클릭하면 펼침
- 매 10턴마다 반드시 🧠 스크린샷
- ❌ 검증 실패 시 반드시 🧠 패널 열어서 진단 (원인A~E)
- AI가 기억 못하면 절대 힌트 주지 말고 그대로 기록
- AI 응답을 있는 그대로 기록 — 추측/해석 금지
- AI가 "기억나지 않는다"고 솔직히 말하면 그것도 기록 (환각보다 나음)
- 대화 자연스러움은 1~5점으로 주관적 평가

## UI 셀렉터

| 요소 | 찾는 법 |
|------|--------|
| 메시지 입력 | textarea (placeholder "메시지를 입력하세요") |
| 전송 | Enter 또는 옆 버튼 |
| 응답 대기 | svg.animate-spin 사라질 때까지 |
| 🧠 메모리 패널 | 마지막 AI 응답 아래 "🧠" 포함 회색 바 클릭 |
| 패널 내 정보 수 | "알고있는 정보 **N**개" 텍스트 |
| surprise 결과 | "이번 턴: NEW/REINFORCE/SKIP (surprise: 0.xx)" |
| 관계 수치 | "신뢰 N 호감 N 존경 N" 텍스트 |
```

이 프롬프트를 Claude Code PC에서 실행하면 됩니다.
OAuth 로그인 단계에서만 수동 개입 필요.
